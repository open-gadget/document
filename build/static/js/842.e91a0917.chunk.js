"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[842,391],{6108:function(e,t,n){n.d(t,{cq:function(){return v},vH:function(){return r}});var r,i=n(1092),a=n(7791),o=n(1976),s=n(2951),l=n(7591),u=n(3904),c=n(7966);!function(e){e.INITIAL="initial",e.IDLE="idle",e.DOWNLOAD="download",e.UNPACK="unpack",e.CLEAR="clear"}(r||(r={}));var d=new(function(e){(0,l.Z)(n,e);var t=(0,u.Z)(n);function n(){var e;return(0,s.Z)(this,n),(e=t.call(this,"MDNOfflineDB")).whoami=void 0,e.contentStatusHistory=void 0,e.collections=void 0,e.watched=void 0,e.notifications=void 0,e.version(1).stores({whoami:"++, username, is_authenticated, email, avatar_url, is_subscriber",collections:"url, title, created",watched:"url, title, path",notifications:"id, title, text, url, created, read, starred"}),e.version(2).stores({contentStatusHistory:"++id"}),e}return(0,o.Z)(n)}(c.ZP));function v(){return f.apply(this,arguments)}function f(){return(f=(0,a.Z)((0,i.Z)().mark((function e(){var t;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.contentStatusHistory.toCollection().last();case 2:return t=e.sent,e.abrupt("return",t||{phase:r.INITIAL,local:null,remote:null,progress:null,timestamp:new Date});case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},2391:function(e,t,n){n.r(t),n.d(t,{MDNWorker:function(){return c},SettingsData:function(){return u},getMDNWorker:function(){return d}});var r=n(189),i=n(1092),a=n(7791),o=n(1976),s=n(2951),l=n(6108),u=(0,o.Z)((function e(){(0,s.Z)(this,e),this.offline=void 0,this.preferOnline=void 0,this.autoUpdates=void 0,this.offline=!1,this.preferOnline=!1,this.autoUpdates=!1})),c=function(){function e(){(0,s.Z)(this,e),this.settings=void 0,this.registered=void 0,this.timeout=void 0,this.keepAlive=void 0,this.settings=this.offlineSettings(),this.registered=!1,this.timeout=null,this.keepAlive=null,this.settings.autoUpdates&&this.autoUpdate()}return(0,o.Z)(e,[{key:"autoUpdate",value:function(){var e=this;console.log("running auto update"),this.timeout&&(clearTimeout(this.timeout),this.timeout=null),this.update(),this.timeout=setTimeout((function(){return e.autoUpdate()}),36e5)}},{key:"messageHandler",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.data.type,e.next="pong"===e.t0?3:5;break;case 3:return console.log("pong"),e.abrupt("break",6);case 5:console.log("unknown message");case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"controller",value:function(){return navigator.serviceWorker.controller}},{key:"checkForUpdate",value:function(){var e;null===(e=this.controller())||void 0===e||e.postMessage({type:"checkForUpdate"})}},{key:"update",value:function(){var e;null===(e=this.controller())||void 0===e||e.postMessage({type:"update"})}},{key:"swName",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=null!==(e=null!==t&&void 0!==t?t:this.settings.preferOnline)&&void 0!==e&&e;return"/service-worker.js?preferOnline=".concat(n)}},{key:"enableServiceWorker",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(){var t,n=arguments;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=n.length>0&&void 0!==n[0]?n[0]:null,!("serviceWorker"in navigator)){e.next=5;break}return e.next=4,navigator.serviceWorker.register(this.swName(t),{scope:"/"});case 4:this.registered=!0;case 5:f();case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"disableServiceWorker",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(){var t;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!("serviceWorker"in navigator)){e.next=7;break}return e.next=3,navigator.serviceWorker.getRegistration();case 3:return t=e.sent,e.next=6,null===t||void 0===t?void 0:t.unregister();case 6:this.registered=!1;case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"toggleKeepAlive",value:function(e){var t=this;this.keepAlive&&!e?(console.log("[worker] keepalive -> enabling"),clearInterval(this.keepAlive),this.keepAlive=null):e&&!this.keepAlive&&(console.log("[worker] keepalive -> disabling"),this.keepAlive=setInterval((function(){var e;return null===(e=t.controller())||void 0===e?void 0:e.postMessage({type:"keepalive"})}),1e4))}},{key:"status",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,l.cq)();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"offlineSettings",value:function(){var e;return null!==(e=JSON.parse(window.localStorage.getItem("MDNSettings")||"null"))&&void 0!==e?e:new u}},{key:"setOfflineSettings",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var n,a;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((n=this.offlineSettings()).offline||!t.offline||this.registered){e.next=6;break}return e.next=4,this.enableServiceWorker(t.preferOnline);case 4:e.next=11;break;case 6:if(!("preferOnline"in t)||n.preferOnline===t.preferOnline){e.next=11;break}return e.next=9,this.disableServiceWorker();case 9:return e.next=11,this.enableServiceWorker(t.preferOnline);case 11:if(!n.offline||!1!==t.offline){e.next=14;break}return e.next=14,this.disableServiceWorker();case 14:return!1===t.autoUpdates&&this.timeout?(clearTimeout(this.timeout),this.timeout=null):!0===t.autoUpdates&&!1===n.autoUpdates&&this.autoUpdate(),a=(0,r.Z)((0,r.Z)({},n),t),window.localStorage.setItem("MDNSettings",JSON.stringify(a)),this.settings=a,e.abrupt("return",a);case 19:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"clear",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(){var t;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null===(t=this.controller())||void 0===t||t.postMessage({type:"clear"});case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}();function d(){return window.mdnWorker||(window.mdnWorker=new c),window.mdnWorker}var v=d();function f(){navigator.serviceWorker.addEventListener("message",v.messageHandler)}v.settings.offline&&v.enableServiceWorker(v.settings.preferOnline)},2842:function(e,t,n){n.r(t),n.d(t,{default:function(){return k}});var r=n(189),i=n(1092),a=n(7791),o=n(5809),s=n(2866),l=n(2391),u=n(2966),c=n(6167),d=n(6108),v=n(7878);function f(e){var t,n,r,i,a,o=e.updateStatus,s=e.update,l=e.disabled,u=void 0!==l&&l,c=(null===o||void 0===o||null===(t=o.local)||void 0===t?void 0:t.date)&&"Last updated: ".concat(Intl.DateTimeFormat([],{dateStyle:"medium"}).format(Date.parse(null===o||void 0===o||null===(n=o.local)||void 0===n?void 0:n.date))),f=null;switch(null===o||void 0===o?void 0:o.phase){case d.vH.INITIAL:a="Checking for updates";break;case d.vH.IDLE:(null===o||void 0===o||null===(r=o.local)||void 0===r?void 0:r.version)===(null===o||void 0===o||null===(i=o.remote)||void 0===i?void 0:i.latest)?(a="Your content is up to date",f=(0,v.jsx)("button",{disabled:!0,children:"Up to date"})):null!==o&&void 0!==o&&o.local?(a="Update available",f=(0,v.jsxs)("button",{className:"button",onClick:s,disabled:u,children:[" ","Update now"]})):(a="Start using MDN Offline by downloading the latest version of MDN Web Docs",f=(0,v.jsxs)("button",{className:"button",onClick:s,disabled:u,children:[" ","Download"]}));break;case d.vH.DOWNLOAD:a=null!==o&&void 0!==o&&o.local?"Update in progress\u2026":"Download in progress\u2026",f=(0,v.jsx)("button",{disabled:u,children:"Downloading\u2026"});break;case d.vH.UNPACK:a=null!==o&&void 0!==o&&o.local?"Update in progress\u2026":"Download in progress\u2026";var p=100*((null===o||void 0===o?void 0:o.progress)||0);f=(0,v.jsxs)("button",{disabled:u,children:["Unpacking\u2026"," ",null===p||void 0===p?void 0:p.toLocaleString(void 0,{maximumFractionDigits:0}),"%"]});break;case d.vH.CLEAR:a="Clearing\u2026"}return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("h4",{children:"Update status"}),(0,v.jsxs)("span",{children:[c,(0,v.jsx)("br",{}),a]}),f]})}function p(e){var t,n=e.updateStatus,r=e.clear,i=e.disabled,a=void 0!==i&&i;return t=(null===n||void 0===n?void 0:n.phase)===d.vH.IDLE&&null!==n&&void 0!==n&&n.local?(0,v.jsx)("button",{className:"button",onClick:r,disabled:a,children:"Clear data"}):(null===n||void 0===n?void 0:n.phase)===d.vH.CLEAR?(0,v.jsx)("button",{disabled:!0,children:"Clearing\u2026"}):(0,v.jsx)("button",{className:"button",disabled:!0,children:"Clear data"}),(0,v.jsx)(v.Fragment,{children:t})}function h(e){var t=e.extraClasses;return(0,v.jsxs)("div",{className:"spinner ".concat(t||""),children:[(0,v.jsx)("div",{}),(0,v.jsx)("div",{}),(0,v.jsx)("div",{}),(0,v.jsx)("div",{})]})}var g=n(7630);function k(e){Object.assign({},e);var t,n,r=null===(t=window)||void 0===t||null===(n=t.navigator)||void 0===n?void 0:n.serviceWorker;return(0,v.jsx)("section",{className:"field-group",children:r?(0,v.jsx)(x,{}):(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("h4",{children:"Offline mode is unavailable "})," ",(0,v.jsx)("p",{children:"Please make sure that you are not using a private or incognito window."})]})})}function x(){var e,t,n;document.title="MDN Offline | ".concat(g.SP);var k=(0,c.useState)(),x=(0,o.Z)(k,2),m=x[0],w=x[1],b=(0,c.useState)(!0),j=(0,o.Z)(b,2),Z=j[0],y=j[1],D=(0,c.useState)(null),N=(0,o.Z)(D,2),S=N[0],W=N[1],O=(0,c.useState)(),U=(0,o.Z)(O,2),A=U[0],M=U[1],C=(0,c.useRef)(!1);(0,c.useEffect)((function(){var e=function(){var e=(0,a.Z)((0,i.Z)().mark((function e(){var t,n,r,a;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=(0,l.getMDNWorker)(),e.t0=M,e.next=4,a.offlineSettings();case 4:return e.t1=e.sent,(0,e.t0)(e.t1),e.t2=W,e.next=9,null===(t=navigator)||void 0===t||null===(n=t.storage)||void 0===n||null===(r=n.estimate)||void 0===r?void 0:r.call(n);case 9:e.t3=e.sent,(0,e.t2)(e.t3),a.checkForUpdate();case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e().then((function(){}))}),[]),(0,c.useEffect)((function(){var e=function(){var e=(0,a.Z)((0,i.Z)().mark((function e(){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:y(!1);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e()}),[A]),(0,c.useEffect)((function(){var e=(0,l.getMDNWorker)(),t=!(null===m||void 0===m||!m.phase)&&(null===m||void 0===m?void 0:m.phase)!==d.vH.IDLE;if(e.toggleKeepAlive(t),t){var n=function(e){e.preventDefault(),e.returnValue=""};return window.addEventListener("beforeunload",n),function(){return window.removeEventListener("beforeunload",n)}}}),[null===m||void 0===m?void 0:m.phase]);var I=function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var n,r;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return y(!0),n=(0,l.getMDNWorker)(),e.next=4,n.setOfflineSettings(t);case 4:r=e.sent,M(r);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();(0,u.default)((0,a.Z)((0,i.Z)().mark((function e(){var t,n;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=(0,l.getMDNWorker)(),e.next=3,t.status();case 3:n=e.sent,w((0,r.Z)({},n));case 5:case"end":return e.stop()}}),e)}))),500);var L=function(){(0,l.getMDNWorker)().update(),w(m)},E=function(){var e=(0,a.Z)((0,i.Z)().mark((function e(){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:window.confirm("All downloaded content will be removed from your device")&&((0,l.getMDNWorker)().clear(),w(m));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();null!==A&&void 0!==A&&A.autoUpdates&&(null===m||void 0===m||null===(e=m.remote)||void 0===e?void 0:e.latest)!==(null===m||void 0===m||null===(t=m.local)||void 0===t?void 0:t.version)&&!C.current&&(L(),C.current=!0);var H=S&&function(e){var t=e.usage,n=void 0===t?0:t,r=(e.quota,Math.round(n/1048576));return"".concat(r," MiB")}(S);return(0,v.jsxs)("ul",{children:[(0,v.jsxs)("li",{children:[(0,v.jsx)("h4",{children:"Enable offline storage"}),(0,v.jsx)("span",{children:"Allow MDN content to be downloaded for offline access"}),!0===Z&&(0,v.jsx)(h,{extraClasses:"loading"})||(0,v.jsx)(s.r,{name:"offline",checked:(null===A||void 0===A?void 0:A.offline)||!1,toggle:function(e){return I({offline:e.target.checked})}})]}),(null===A||void 0===A?void 0:A.offline)&&(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)("li",{children:[(0,v.jsx)("h4",{children:"Prefer online content"}),(0,v.jsx)("span",{children:"Do not use offline content while connected to the internet"}),!0===Z&&(0,v.jsx)(h,{extraClasses:"loading"})||(0,v.jsx)(s.r,{name:"prefer-online",checked:(null===A||void 0===A?void 0:A.preferOnline)||!1,toggle:function(e){return I({preferOnline:e.target.checked})}})]}),(0,v.jsx)("li",{children:(0,v.jsx)(f,{disabled:Z,updateStatus:m||null,update:L})}),(0,v.jsxs)("li",{children:[(0,v.jsx)("h4",{children:"Enable auto-update"}),(0,v.jsx)("span",{children:"Automatically download updates to content enabled for download"}),!0===Z&&(0,v.jsx)(h,{extraClasses:"loading"})||(0,v.jsx)(s.r,{name:"auto-update",checked:(null===A||void 0===A?void 0:A.autoUpdates)||!1,toggle:function(e){return I({autoUpdates:e.target.checked})}})]}),"#debug"===(null===(n=window)||void 0===n?void 0:n.location.hash)&&(0,v.jsxs)("li",{children:[(0,v.jsx)("h4",{children:"Debug"}),(0,v.jsx)("span",{style:{fontFamily:"monospace",whiteSpace:"pre"},children:JSON.stringify(m,null,2)})]}),H&&(0,v.jsxs)("li",{children:[(0,v.jsx)("h4",{children:"Storage used"}),(0,v.jsxs)("span",{children:["MDN Offline currently uses ",(0,v.jsx)("b",{children:H})]})]}),(0,v.jsx)("li",{children:(0,v.jsx)(p,{disabled:Z,updateStatus:m||null,clear:E})})]})]})}},2866:function(e,t,n){n.d(t,{r:function(){return i}});var r=n(7878);function i(e){var t=e.name,n=e.hiddenLabel,i=e.checked,a=void 0!==i&&i,o=e.toggle,s=void 0===o?function(){}:o,l=e.children;return(0,r.jsxs)("label",{className:"switch",children:[n&&(0,r.jsx)("span",{className:"visually-hidden",children:n}),(0,r.jsx)("input",{type:"checkbox",name:t,checked:a,onChange:s}),(0,r.jsx)("span",{className:"slider"}),l&&(0,r.jsx)("span",{className:"label",children:l})]})}},2966:function(e,t,n){e.exports=n(7717)},7717:function(e,t,n){var r=n(6167);t.default=function(e,t){var n=r.useRef();r.useEffect((function(){n.current=e}),[e]),r.useEffect((function(){if(null!==t){var e=setInterval((function(){return n.current.apply(n,arguments)}),t);return function(){return clearInterval(e)}}}),[t])}}}]);
//# sourceMappingURL=842.e91a0917.chunk.js.map