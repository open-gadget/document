"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[211],{2666:function(e,n,t){function r(e){return{bad_bcd_queries:"Bad BCD queries",bad_bcd_links:"Bad BCD links",bad_pre_tags:"Bad <pre> tags",unsafe_html:"Unsafe HTML"}[e]||e.charAt(0).toUpperCase()+e.slice(1).replace(/_/g," ")}t.d(n,{j:function(){return r}})},211:function(e,n,t){t.r(n),t.d(n,{default:function(){return y}});var r=t(726),s=t(1092),a=t(7791),c=t(3782),l=t(189),i=t(126),o=t(5809),u=t(6167),d=t(1e3),h=t(3400),f=t(8074),x=t(2666),j=t(4187),p=t(7878),v=["sort_by","sort_reverse","page"],m=Object.freeze({mdn_url:"",title:"",popularity:"",fixableFlaws:"",flaws:[],page:1,sort_by:"popularity",sort_reverse:!1,search_flaws:[]});function g(e){return Object.fromEntries(Object.entries(e).filter((function(e){var n=(0,o.Z)(e,2),t=n[0],r=n[1];return JSON.stringify(m[t])!==JSON.stringify(r)})))}function b(){var e=(0,d.lr)(),n=(0,o.Z)(e,2),t=n[0],r=n[1];for(var s=(0,u.useMemo)((function(){var e,n=(e=t,(0,i.Z)(e.entries()).reduce((function(e,n){var t=(0,o.Z)(n,2),r=t[0],s=t[1];return Object.prototype.hasOwnProperty.call(e,r)?Array.isArray(e[r])?e[r]=[].concat((0,i.Z)(e[r]),[s]):e[r]=[e[r],s]:e[r]=s,e}),{}));return n.page&&(n.page=parseInt(n.page)),(0,l.Z)((0,l.Z)({},m),n)}),[t]),a=(0,u.useCallback)((function(e){var n=g((0,l.Z)((0,l.Z)({},s),e));r(n)}),[s,r]),c=0,h=["flaws","search_flaws"];c<h.length;c++){var f=h[c];s[f]&&!Array.isArray(s[f])&&(s[f]=[s[f]])}return[s,a]}function y(){var e=(0,h.UO)().locale,n=void 0===e?"en-US":e,t=b(),r=(0,o.Z)(t,1)[0],i=(0,u.useState)(null),x=(0,o.Z)(i,2),m=x[0],g=x[1];(0,u.useEffect)((function(){var e="Documents with flaws";m&&(e="(".concat(m.counts.found.toLocaleString()," found) ").concat(e)),document.title=e}),[m]);var y=(0,u.useCallback)((function(){var e=r.sort_by,t=r.sort_reverse,s=r.page,a=(0,c.Z)(r,v),i=(0,d.fW)((0,l.Z)((0,l.Z)({},a),{},{page:String(s),locale:n,sort:e,reverse:JSON.stringify(t)}));return"/_flaws?".concat(i.toString())}),[n,r]),N=(0,f.ZP)(y(),function(){var e=(0,a.Z)((0,s.Z)().mark((function e(n){var t;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch(n);case 3:t=e.sent,e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(0),e.t0;case 9:if(t.ok){e.next=11;break}throw new Error("".concat(t.status," on ").concat(n));case 11:if(t.headers.get("content-type").includes("application/json")){e.next=13;break}throw new Error("Response is not JSON (".concat(t.headers.get("content-type"),")"));case 13:return e.abrupt("return",t.json());case 14:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(n){return e.apply(this,arguments)}}(),{}),F=N.data,O=N.error,L=N.isValidating;(0,u.useEffect)((function(){F&&g(F)}),[F]);var B=(0,p.jsx)("small",{children:"\xa0"});F||O?L&&(B=(0,p.jsx)("small",{children:"Reloading..."})):B=m?(0,p.jsx)("small",{children:"Reloading..."}):(0,p.jsx)("small",{children:"Loading..."});var A=r.page,D=m?m.counts.pages:0;return(0,p.jsx)("div",{className:"all-flaws",children:(0,p.jsxs)(j.R,{children:[B,O&&(0,p.jsx)(w,{error:O}),m&&(0,p.jsxs)("div",{className:"filter-documents",children:[(0,p.jsx)(_,{flawLevels:m.flawLevels}),(0,p.jsx)(k,{locale:n,counts:m.counts,documents:m.documents}),D>1&&(0,p.jsxs)("p",{className:"pagination",children:[(0,p.jsx)(S,{number:1,disabled:1===A,children:"First page"})," ",A>2&&(0,p.jsxs)(S,{number:A-1,children:["Previous page (",A-1,")"]})," ",(0,p.jsxs)(S,{number:A+1,disabled:A+1>D,children:["Next page (",A+1,")"]})]})]}),F&&F.counts&&(0,p.jsx)(C,{counts:F.counts.flaws}),F&&(0,p.jsx)(Z,{times:F.times})]})})}function w(e){var n=e.error;return(0,p.jsxs)("div",{className:"error-message search-error",children:[(0,p.jsx)("h3",{children:"Search error"}),(0,p.jsx)("pre",{children:n.toString()})]})}function Z(e){var n,t=e.times;return(0,p.jsx)("div",{className:"search-times",children:(0,p.jsxs)("p",{children:["Time to find built documents ",(n=t.built,n>1e3?"".concat((n/1e3).toFixed(1)," seconds"):"".concat(Math.trunc(n)," milliseconds"))]})})}function _(e){var n=e.flawLevels,t=b(),s=(0,o.Z)(t,2),a=s[0],c=s[1],d=(0,u.useState)(a),h=(0,o.Z)(d,2),f=h[0],j=h[1],v=(0,u.useState)(function(e){var n,t=[],s=(0,r.Z)(e);try{for(s.s();!(n=s.n()).done;){var a=n.value.split(":",2),c=(0,o.Z)(a,2),l=c[0],i=c[1];t.push({flaw:l,search:i})}}catch(u){s.e(u)}finally{s.f()}return t}(a.search_flaws)),g=(0,o.Z)(v,2),y=g[0],w=g[1];function Z(){c(f)}(0,u.useEffect)((function(){var e=(0,i.Z)(document.querySelectorAll('ul.search-flaws-rows input[type="search"]')).filter((function(e){return!e.value}));e.length&&e[e.length-1].focus()}),[y]);var _=!function(e,n){var t=new Set(Object.keys(e)),s=new Set(Object.keys(n));if(t.size!==s.size)return!1;var a,c=(0,r.Z)(t);try{for(c.s();!(a=c.n()).done;){var l=a.value;if(!s.has(l))return!1}}catch(i){c.e(i)}finally{c.f()}return Object.entries(e).every((function(e){var t=(0,o.Z)(e,2),r=t[0],s=t[1],a=n[r];return typeof s===typeof a&&(Array.isArray(s)?s.length===a.length&&s.every((function(e,n){return e===a[n]})):s===a)}))}(m,f),k=y.some((function(e){return!e.search.trim()}));return(0,p.jsxs)("div",{className:"filters",children:[(0,p.jsx)("h3",{children:"Filters"}),(0,p.jsxs)("form",{onSubmit:function(e){e.preventDefault(),Z()},children:[(0,p.jsxs)("div",{children:[(0,p.jsx)("h4",{children:"Document"}),(0,p.jsx)("input",{type:"search",placeholder:"Filter by document URI",value:f.mdn_url,onChange:function(e){j((0,l.Z)((0,l.Z)({},f),{},{mdn_url:e.target.value}))},onBlur:Z}),(0,p.jsx)("input",{type:"search",placeholder:"Filter by document title",value:f.title,onChange:function(e){j((0,l.Z)((0,l.Z)({},f),{},{title:e.target.value}))},onBlur:Z})]}),(0,p.jsxs)("div",{children:[(0,p.jsx)("h4",{children:"Popularity"}),(0,p.jsx)("input",{type:"search",placeholder:"E.g. < 100",value:f.popularity||"",onChange:function(e){j((0,l.Z)((0,l.Z)({},f),{},{popularity:e.target.value}))},onBlur:Z})]}),(0,p.jsxs)("div",{children:[(0,p.jsx)("h4",{children:"Flaws"}),(0,p.jsx)("select",{multiple:!0,value:f.flaws,onChange:function(e){var n=(0,i.Z)(e.target.selectedOptions).map((function(e){return e.value}));j((0,l.Z)((0,l.Z)({},f),{},{flaws:n}))},children:n&&n.map((function(e){return(0,p.jsxs)("option",{value:e.name,children:[(0,x.j)(e.name)," ",e.ignored&&"(ignored)"]},e.name)}))})]}),(0,p.jsxs)("div",{children:[(0,p.jsx)("h4",{children:"Search inside flaws"}),(0,p.jsx)("ul",{className:"search-flaws-rows",children:y.map((function(e,t){return(0,p.jsxs)("li",{children:[(0,p.jsx)("select",{value:e.flaw,onChange:function(e){var n=(0,i.Z)(y);n[t].flaw=e.target.value,w(n)},children:n&&n.filter((function(e){return!e.ignored})).map((function(e){return(0,p.jsx)("option",{value:e.name,children:(0,x.j)(e.name)},e.name)}))}),(0,p.jsx)("input",{type:"search",placeholder:"Search expression (e.g. jsxref)",value:e.search,onChange:function(e){w(y.map((function(n,r){return t===r&&(n.search=e.target.value),n})))},onBlur:function(){var e=y.map((function(e){return"".concat(e.flaw,":").concat(e.search)}));j((0,l.Z)((0,l.Z)({},f),{},{search_flaws:e})),Z()}}),(0,p.jsx)("button",{type:"button",title:"Remove search row",onClick:function(){var e=(0,i.Z)(y);e.splice(t,1),w(e)},children:"-"})]},"".concat(e.flaw,":").concat(t))}))}),(0,p.jsx)("button",{type:"button",title:"Add search row",disabled:k,onClick:function(){w([].concat((0,i.Z)(y),[{flaw:"macros",search:""}]))},children:"+"})]}),(0,p.jsxs)("div",{children:[(0,p.jsx)("h4",{children:"Fixable flaws"}),(0,p.jsx)("input",{type:"search",placeholder:"E.g. >0",value:f.fixableFlaws||"",onChange:function(e){j((0,l.Z)((0,l.Z)({},f),{},{fixableFlaws:e.target.value}))},onBlur:Z})]}),(0,p.jsxs)("div",{children:[(0,p.jsx)("h4",{children:"\xa0"}),(0,p.jsx)("button",{type:"submit",children:"Filter now"}),_&&(0,p.jsx)("button",{type:"button",onClick:function(e){e.preventDefault(),j(m),c(m)},children:"Reset filters"})]})]})]})}function k(e){var n=e.locale,t=e.counts,r=e.documents,s=b(),a=(0,o.Z)(s,2),c=a[0],l=a[1];function i(e){var n=["th","st","nd","rd"],t=e%100;return e.toLocaleString()+(n[(t-20)%10]||n[t]||n[0])}function u(e){var n=e.reduce((function(e,n){return n.countFixable+e}),0),t=e.map((function(e){return"".concat((0,x.j)(e.name),": ").concat(e.value)}));return"".concat(t.join(", ")," (").concat(n," fixable)")}function h(e){var n=e.id,t=e.title;return(0,p.jsxs)("th",{onClick:function(){return e=n,void l(c.sort_by===e?{sort_reverse:!c.sort_reverse}:{sort_by:e});var e},className:"sortable",children:[t," ",c.sort_by===n?c.sort_reverse?"\ud83d\udd3d":"\ud83d\udd3c":null]})}function f(e,n){var t=e.split(new RegExp("(".concat(n,")"),"gi"));return(0,p.jsxs)("span",{children:[" ",t.map((function(e,t){return(0,p.jsx)("span",{style:e.toLowerCase()===n.toLowerCase()?{fontWeight:"bold"}:{},children:e},t)}))," "]})}function j(e){var n=e.split(/\/docs\//,2),t=(0,o.Z)(n,2),r=t[0],s=t[1];return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsxs)("span",{className:"url-prefix",children:[r,"/docs/"]}),(0,p.jsx)("span",{className:"url-slug",children:c.mdn_url?f(s,c.mdn_url):s})]})}return(0,p.jsxs)("div",{className:"documents",children:[(0,p.jsxs)("h3",{children:["Documents with flaws found (",t.found.toLocaleString(),")"," ",c.page>1&&(0,p.jsxs)("span",{className:"page",children:["page ",c.page]})]}),t.built?(0,p.jsxs)("h4",{className:"subheader",children:[t.built.toLocaleString()," documents built (",n,")"]}):(0,p.jsx)(N,{}),(0,p.jsxs)("table",{children:[(0,p.jsx)("thead",{children:(0,p.jsxs)("tr",{children:[(0,p.jsx)(h,{id:"mdn_url",title:"Document"}),(0,p.jsx)(h,{id:"popularity",title:"Popularity"}),(0,p.jsx)(h,{id:"flaws",title:"Flaws"})]})}),(0,p.jsx)("tbody",{children:r.map((function(e){return(0,p.jsxs)("tr",{children:[(0,p.jsxs)("td",{children:[(0,p.jsx)(d.rU,{to:"".concat(e.mdn_url,"#_flaws"),title:e.title,target:"_blank",children:j(e.mdn_url)}),(0,p.jsx)("span",{className:"document-title-preview",children:c.title?f(e.title,c.title):e.title})]}),(0,p.jsx)("td",{title:e.popularity.ranking?"Meaning there are ".concat(e.popularity.ranking-1," more popular pages than this"):"Meaning it has no ranking. Most likely a very rare (or new) document",children:e.popularity.ranking?"".concat(i(e.popularity.ranking)):"n/a"}),(0,p.jsx)("td",{children:u(e.flaws)})]},e.mdn_url)}))})]})]})}function S(e){var n=e.number,t=e.disabled,r=e.children,s=b(),a=(0,o.Z)(s,1)[0],c=g((0,l.Z)((0,l.Z)({},a),{},{page:n}));return c.page&&(c.page=String(c.page)),(0,p.jsx)(d.rU,{to:"?"+(0,d.fW)(c).toString(),className:t?"disabled":"",onClick:function(e){t&&e.preventDefault()},children:r})}function N(){return(0,p.jsxs)("div",{className:"attention document-warnings",children:[(0,p.jsx)("h4",{children:"No documents have been built, so no flaws can be found"}),(0,p.jsx)("p",{children:"At the moment, you have to use the command line tools to build documents that we can analyze."})]})}function C(e){var n=e.counts,t=Object.entries(n.type).sort((function(e,n){return e[1]-n[1]})),r=Object.entries(n.macros).sort((function(e,n){return e[1]-n[1]}));return(0,p.jsxs)("div",{className:"flaw-counts",children:[(0,p.jsx)("h3",{children:"Flaws counts"}),(0,p.jsx)("table",{children:(0,p.jsxs)("tbody",{children:[(0,p.jsxs)("tr",{children:[(0,p.jsx)("td",{children:"Total"}),(0,p.jsx)("td",{children:(0,p.jsx)("b",{children:n.total.toLocaleString()})})]}),(0,p.jsxs)("tr",{children:[(0,p.jsx)("td",{children:"Fixable"}),(0,p.jsx)("td",{children:(0,p.jsx)("b",{children:n.fixable.toLocaleString()})})]})]})}),(0,p.jsx)("h4",{children:"Breakdown by type"}),(0,p.jsxs)("table",{children:[(0,p.jsx)("thead",{children:(0,p.jsxs)("tr",{children:[(0,p.jsx)("th",{children:"Type"}),(0,p.jsx)("th",{children:"Count"})]})}),(0,p.jsx)("tbody",{children:t.map((function(e){var n=(0,o.Z)(e,2),t=n[0],r=n[1];return(0,p.jsxs)("tr",{children:[(0,p.jsx)("td",{children:(0,x.j)(t)}),(0,p.jsx)("td",{children:(0,p.jsx)("b",{children:r.toLocaleString()})})]},t)}))})]}),(0,p.jsxs)("h4",{children:["Breakdown by ",(0,p.jsx)("code",{children:"macros"})," flaws"]}),(0,p.jsxs)("table",{children:[(0,p.jsx)("thead",{children:(0,p.jsxs)("tr",{children:[(0,p.jsx)("th",{children:"Name"}),(0,p.jsx)("th",{children:"Count"})]})}),(0,p.jsx)("tbody",{children:r.map((function(e){var n=(0,o.Z)(e,2),t=n[0],r=n[1];return(0,p.jsxs)("tr",{children:[(0,p.jsx)("td",{children:(0,p.jsx)("code",{children:t})}),(0,p.jsx)("td",{children:(0,p.jsx)("b",{children:r.toLocaleString()})})]},t)}))})]})]})}}}]);
//# sourceMappingURL=211.08b571a6.chunk.js.map